\hypertarget{main_8hpp_source}{}\doxysection{main.\+hpp}
\mbox{\hyperlink{main_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// Copyright (c) Stanford University, The Regents of the University of}}
\DoxyCodeLine{2 \textcolor{comment}{//               California, and others.}}
\DoxyCodeLine{3 \textcolor{comment}{//}}
\DoxyCodeLine{4 \textcolor{comment}{// All Rights Reserved.}}
\DoxyCodeLine{5 \textcolor{comment}{//}}
\DoxyCodeLine{6 \textcolor{comment}{// See Copyright-\/SimVascular.txt for additional details.}}
\DoxyCodeLine{7 \textcolor{comment}{//}}
\DoxyCodeLine{8 \textcolor{comment}{// Permission is hereby granted, free of charge, to any person obtaining}}
\DoxyCodeLine{9 \textcolor{comment}{// a copy of this software and associated documentation files (the}}
\DoxyCodeLine{10 \textcolor{comment}{// "{}Software"{}), to deal in the Software without restriction, including}}
\DoxyCodeLine{11 \textcolor{comment}{// without limitation the rights to use, copy, modify, merge, publish,}}
\DoxyCodeLine{12 \textcolor{comment}{// distribute, sublicense, and/or sell copies of the Software, and to}}
\DoxyCodeLine{13 \textcolor{comment}{// permit persons to whom the Software is furnished to do so, subject}}
\DoxyCodeLine{14 \textcolor{comment}{// to the following conditions:}}
\DoxyCodeLine{15 \textcolor{comment}{//}}
\DoxyCodeLine{16 \textcolor{comment}{// The above copyright notice and this permission notice shall be included}}
\DoxyCodeLine{17 \textcolor{comment}{// in all copies or substantial portions of the Software.}}
\DoxyCodeLine{18 \textcolor{comment}{//}}
\DoxyCodeLine{19 \textcolor{comment}{// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "{}AS}}
\DoxyCodeLine{20 \textcolor{comment}{// IS"{} AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED}}
\DoxyCodeLine{21 \textcolor{comment}{// TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A}}
\DoxyCodeLine{22 \textcolor{comment}{// PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER}}
\DoxyCodeLine{23 \textcolor{comment}{// OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,}}
\DoxyCodeLine{24 \textcolor{comment}{// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,}}
\DoxyCodeLine{25 \textcolor{comment}{// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR}}
\DoxyCodeLine{26 \textcolor{comment}{// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF}}
\DoxyCodeLine{27 \textcolor{comment}{// LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING}}
\DoxyCodeLine{28 \textcolor{comment}{// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS}}
\DoxyCodeLine{29 \textcolor{comment}{// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.}}
\DoxyCodeLine{30 \textcolor{comment}{// clang-\/format off}\textcolor{comment}{}}
\DoxyCodeLine{31 \textcolor{comment}{/**}}
\DoxyCodeLine{32 \textcolor{comment}{ * @file main.hpp}}
\DoxyCodeLine{33 \textcolor{comment}{ * @brief Main page documentation}}
\DoxyCodeLine{34 \textcolor{comment}{ *}}
\DoxyCodeLine{35 \textcolor{comment}{ * @mainpage svZeroDSolver}}
\DoxyCodeLine{36 \textcolor{comment}{ *}}
\DoxyCodeLine{37 \textcolor{comment}{ * \(\backslash\)tableofcontents}}
\DoxyCodeLine{38 \textcolor{comment}{ *}}
\DoxyCodeLine{39 \textcolor{comment}{ * The svZeroDSolver is a fast simulation tool for modeling the hemodynamics of}}
\DoxyCodeLine{40 \textcolor{comment}{ * vascular networks using zero-\/dimensional (0D) lumped parameter models.}}
\DoxyCodeLine{41 \textcolor{comment}{ *}}
\DoxyCodeLine{42 \textcolor{comment}{ * * <a href="{}https://github.com/StanfordCBCL/svZeroDPlus"{}>Source}}
\DoxyCodeLine{43 \textcolor{comment}{ * repository</a>}}
\DoxyCodeLine{44 \textcolor{comment}{ * * <a href="{}https://simvascular.github.io"{}>About SimVascular</a>}}
\DoxyCodeLine{45 \textcolor{comment}{ *}}
\DoxyCodeLine{46 \textcolor{comment}{ * \(\backslash\)f[}}
\DoxyCodeLine{47 \textcolor{comment}{ * \(\backslash\)begin\{circuitikz\} \(\backslash\)draw}}
\DoxyCodeLine{48 \textcolor{comment}{ * node[left] \{\$Q\_\{in\}\$\} [-\/latex] (0,0) -\/-\/ (0.8,0);}}
\DoxyCodeLine{49 \textcolor{comment}{ * \(\backslash\)draw (1,0) node[anchor=south]\{\$P\_\{in\}\$\}}}
\DoxyCodeLine{50 \textcolor{comment}{ * to [R, l=\$R\$, *-\/] (3,0) node[anchor=south] \{\$P\_\{C\}\$\}}}
\DoxyCodeLine{51 \textcolor{comment}{ * (3,0) to [L, l=\$L\$, *-\/*] (5,0)}}
\DoxyCodeLine{52 \textcolor{comment}{ * node[anchor=south]\{\$P\_\{out\}\$\}}}
\DoxyCodeLine{53 \textcolor{comment}{ * (3,0) to [C, l=\$C\$, *-\/] (3,-\/1.5)}}
\DoxyCodeLine{54 \textcolor{comment}{ * node[ground]\{\};}}
\DoxyCodeLine{55 \textcolor{comment}{ * \(\backslash\)draw [-\/latex] (5.2,0) -\/-\/ (6,0) node[right] \{\$Q\_\{out\}\$\};}}
\DoxyCodeLine{56 \textcolor{comment}{ * \(\backslash\)end\{circuitikz\}}}
\DoxyCodeLine{57 \textcolor{comment}{ * \(\backslash\)f]}}
\DoxyCodeLine{58 \textcolor{comment}{ *}}
\DoxyCodeLine{59 \textcolor{comment}{ * \# Background}}
\DoxyCodeLine{60 \textcolor{comment}{ *}}
\DoxyCodeLine{61 \textcolor{comment}{ * Zero-\/dimensional (0D) models}}
\DoxyCodeLine{62 \textcolor{comment}{ * are lightweight methods to simulate bulk hemodynamic quantities in the}}
\DoxyCodeLine{63 \textcolor{comment}{ * cardiovascular system. Unlike 3D and 1D models, 0D models are purely}}
\DoxyCodeLine{64 \textcolor{comment}{ * time-\/dependent; they are unable to simulate spatial patterns in the}}
\DoxyCodeLine{65 \textcolor{comment}{ * hemodynamics. 0D models are analogous to electrical circuits. The flow rate}}
\DoxyCodeLine{66 \textcolor{comment}{ * simulated by 0D models represents electrical current, while the pressure}}
\DoxyCodeLine{67 \textcolor{comment}{ * represents voltage. Three primary building blocks of 0D models are resistors,}}
\DoxyCodeLine{68 \textcolor{comment}{ * capacitors, and inductors Resistance captures the viscous effects of blood}}
\DoxyCodeLine{69 \textcolor{comment}{ * flow, capacitance represents the compliance and distensibility of the vessel}}
\DoxyCodeLine{70 \textcolor{comment}{ * wall, and inductance represents the inertia of the blood flow. Different}}
\DoxyCodeLine{71 \textcolor{comment}{ * combinations of these building blocks, as well as others, can be formed to}}
\DoxyCodeLine{72 \textcolor{comment}{ * reflect the hemodynamics and physiology of different cardiovascular}}
\DoxyCodeLine{73 \textcolor{comment}{ * anatomies. These 0D models are governed by differential algebraic equations}}
\DoxyCodeLine{74 \textcolor{comment}{ * (DAEs).}}
\DoxyCodeLine{75 \textcolor{comment}{ *}}
\DoxyCodeLine{76 \textcolor{comment}{ * \# Architecture}}
\DoxyCodeLine{77 \textcolor{comment}{ *}}
\DoxyCodeLine{78 \textcolor{comment}{ * \#\# Model}}
\DoxyCodeLine{79 \textcolor{comment}{ *}}
\DoxyCodeLine{80 \textcolor{comment}{ * The solver uses a highly modular framework to model the vascular anatomy,}}
\DoxyCodeLine{81 \textcolor{comment}{ * using individual classes to represent different 0D elements of the}}
\DoxyCodeLine{82 \textcolor{comment}{ * model. The elements are part of the MODEL namespace. Currently}}
\DoxyCodeLine{83 \textcolor{comment}{ * supported elements are:}}
\DoxyCodeLine{84 \textcolor{comment}{ * }}
\DoxyCodeLine{85 \textcolor{comment}{ * \#\#\#\# Vessels}}
\DoxyCodeLine{86 \textcolor{comment}{ *}}
\DoxyCodeLine{87 \textcolor{comment}{ * * MODEL::BloodVessel: RCL blood vessel with optional stenosis.}}
\DoxyCodeLine{88 \textcolor{comment}{ * }}
\DoxyCodeLine{89 \textcolor{comment}{ * \#\#\#\# Junctions}}
\DoxyCodeLine{90 \textcolor{comment}{ * }}
\DoxyCodeLine{91 \textcolor{comment}{ * * MODEL::Junction: Mass conservation junction element.}}
\DoxyCodeLine{92 \textcolor{comment}{ * * MODEL::ResistiveJunction: Resistive junction element.}}
\DoxyCodeLine{93 \textcolor{comment}{ * * MODEL::BloodVesselJunction: RCL junction element with optional stenoses.}}
\DoxyCodeLine{94 \textcolor{comment}{ * }}
\DoxyCodeLine{95 \textcolor{comment}{ * \#\#\#\# Boundary conditions}}
\DoxyCodeLine{96 \textcolor{comment}{ * }}
\DoxyCodeLine{97 \textcolor{comment}{ * * MODEL::FlowReferenceBC: Prescribed flow boundary condition.}}
\DoxyCodeLine{98 \textcolor{comment}{ * * MODEL::PressureReferenceBC: Prescribed pressure boundary condition.}}
\DoxyCodeLine{99 \textcolor{comment}{ * * MODEL::ResistanceBC: Resistance boundary condition.}}
\DoxyCodeLine{100 \textcolor{comment}{ * * MODEL::WindkesselBC: RCR Windkessel boundary condition.}}
\DoxyCodeLine{101 \textcolor{comment}{ * * MODEL::OpenLoopCoronaryBC: Open Loop coronary boundary condition.}}
\DoxyCodeLine{102 \textcolor{comment}{ * * MODEL::ClosedLoopCoronaryBC: Closed Loop coronary boundary condition.}}
\DoxyCodeLine{103 \textcolor{comment}{ * * MODEL::ClosedLoopHeartPulmonary: Heart and pulmonary circulation model.}}
\DoxyCodeLine{104 \textcolor{comment}{ *}}
\DoxyCodeLine{105 \textcolor{comment}{ * The elements are based on the parent MODEL::Block class. More information}}
\DoxyCodeLine{106 \textcolor{comment}{ * about the elements can be found on their respective pages. The elements are}}
\DoxyCodeLine{107 \textcolor{comment}{ * connected to each other via nodes (see MODEL::Node). Each node corresponds to}}
\DoxyCodeLine{108 \textcolor{comment}{ * a flow and a pressure value of the model. The MODEL::DOFHandler handles the}}
\DoxyCodeLine{109 \textcolor{comment}{ * degrees-\/of-\/freedom (DOF) of the system by assigning DOF indices to each}}
\DoxyCodeLine{110 \textcolor{comment}{ * element that determine the location of the local element contribution in the}}
\DoxyCodeLine{111 \textcolor{comment}{ * global system. The complete model is stored and managed by the MODEL::Model}}
\DoxyCodeLine{112 \textcolor{comment}{ * class.}}
\DoxyCodeLine{113 \textcolor{comment}{ *}}
\DoxyCodeLine{114 \textcolor{comment}{ * \#\# Algebra}}
\DoxyCodeLine{115 \textcolor{comment}{ *}}
\DoxyCodeLine{116 \textcolor{comment}{ * Everything related to solving the system of equation is contained in the}}
\DoxyCodeLine{117 \textcolor{comment}{ * ALGEBRA namespace. The ALGEBRA::Integrator}}
\DoxyCodeLine{118 \textcolor{comment}{ * handles the time integration scheme (see Integrator documentation for}}
\DoxyCodeLine{119 \textcolor{comment}{ * more information on that).}}
\DoxyCodeLine{120 \textcolor{comment}{ *}}
\DoxyCodeLine{121 \textcolor{comment}{ * \#\# Input/output}}
\DoxyCodeLine{122 \textcolor{comment}{ *}}
\DoxyCodeLine{123 \textcolor{comment}{ * Finally the IO namespace provides everything related to reading and writing}}
\DoxyCodeLine{124 \textcolor{comment}{ * files. The IO::ConfigReader reads the simulation config and IO::to\_vessel\_csv and}}
\DoxyCodeLine{125 \textcolor{comment}{ * IO::to\_variable\_csv are two different methods for writing the result files.}}
\DoxyCodeLine{126 \textcolor{comment}{ *}}
\DoxyCodeLine{127 \textcolor{comment}{ * \# Build svZeroDSolver}}
\DoxyCodeLine{128 \textcolor{comment}{ *}}
\DoxyCodeLine{129 \textcolor{comment}{ * svZeroDSolver uses CMake to build the tool. The dependencies are installed}}
\DoxyCodeLine{130 \textcolor{comment}{ * by CMake. Currently supported are:}}
\DoxyCodeLine{131 \textcolor{comment}{ * }}
\DoxyCodeLine{132 \textcolor{comment}{ * * Ubuntu 18}}
\DoxyCodeLine{133 \textcolor{comment}{ * * Ubuntu 20}}
\DoxyCodeLine{134 \textcolor{comment}{ * * Ubuntu 22}}
\DoxyCodeLine{135 \textcolor{comment}{ * * macOS Big Sur}}
\DoxyCodeLine{136 \textcolor{comment}{ * * macOS Monterey}}
\DoxyCodeLine{137 \textcolor{comment}{ * }}
\DoxyCodeLine{138 \textcolor{comment}{ * @note If you want to use the Python interface of svZeroDPlus make}}
\DoxyCodeLine{139 \textcolor{comment}{ * sure to **activate the correct Python environment** before building the}}
\DoxyCodeLine{140 \textcolor{comment}{ * solver. Also make sure to install the Python package using the `-\/e` options,}}
\DoxyCodeLine{141 \textcolor{comment}{ * i.e.}}
\DoxyCodeLine{142 \textcolor{comment}{ * \(\backslash\)code}}
\DoxyCodeLine{143 \textcolor{comment}{ * pip install -\/e .}}
\DoxyCodeLine{144 \textcolor{comment}{ * \(\backslash\)endcode}}
\DoxyCodeLine{145 \textcolor{comment}{ *}}
\DoxyCodeLine{146 \textcolor{comment}{ * \#\# Build in debug mode}}
\DoxyCodeLine{147 \textcolor{comment}{ *}}
\DoxyCodeLine{148 \textcolor{comment}{ * \(\backslash\)code}}
\DoxyCodeLine{149 \textcolor{comment}{ * mkdir Debug}}
\DoxyCodeLine{150 \textcolor{comment}{ * cd Debug}}
\DoxyCodeLine{151 \textcolor{comment}{ * cmake -\/DCMAKE\_BUILD\_TYPE=Debug ..}}
\DoxyCodeLine{152 \textcolor{comment}{ * cmake -\/-\/build .}}
\DoxyCodeLine{153 \textcolor{comment}{ * \(\backslash\)endcode}}
\DoxyCodeLine{154 \textcolor{comment}{ *}}
\DoxyCodeLine{155 \textcolor{comment}{ * \#\# Build in release mode}}
\DoxyCodeLine{156 \textcolor{comment}{ * \(\backslash\)code}}
\DoxyCodeLine{157 \textcolor{comment}{ * mkdir Release}}
\DoxyCodeLine{158 \textcolor{comment}{ * cd Release}}
\DoxyCodeLine{159 \textcolor{comment}{ * cmake -\/DCMAKE\_BUILD\_TYPE=Release ..}}
\DoxyCodeLine{160 \textcolor{comment}{ * cmake -\/-\/build .}}
\DoxyCodeLine{161 \textcolor{comment}{ * \(\backslash\)endcode}}
\DoxyCodeLine{162 \textcolor{comment}{ * }}
\DoxyCodeLine{163 \textcolor{comment}{ * \#\# Build on Sherlock}}
\DoxyCodeLine{164 \textcolor{comment}{ * \(\backslash\)code}}
\DoxyCodeLine{165 \textcolor{comment}{ * module load cmake/3.23.1 gcc/12.1.0 binutils/2.38}}
\DoxyCodeLine{166 \textcolor{comment}{ * mkdir Release}}
\DoxyCodeLine{167 \textcolor{comment}{ * cd Release}}
\DoxyCodeLine{168 \textcolor{comment}{ * cmake -\/DCMAKE\_BUILD\_TYPE=Release -\/DCMAKE\_CXX\_COMPILER=/share/software/user/open/gcc/12.1.0/bin/g++ -\/DCMAKE\_C\_COMPILER=/share/software/user/open/gcc/12.1.0/bin/gcc ..}}
\DoxyCodeLine{169 \textcolor{comment}{ * cmake -\/-\/build .}}
\DoxyCodeLine{170 \textcolor{comment}{ * \(\backslash\)endcode}}
\DoxyCodeLine{171 \textcolor{comment}{ *}}
\DoxyCodeLine{172 \textcolor{comment}{ * \# Run svZeroDSolver}}
\DoxyCodeLine{173 \textcolor{comment}{ *}}
\DoxyCodeLine{174 \textcolor{comment}{ * After building svZeroDSolver, the build folder contains an executable}}
\DoxyCodeLine{175 \textcolor{comment}{ * called `svzerodsolver`. Run it with one of:}}
\DoxyCodeLine{176 \textcolor{comment}{ *}}
\DoxyCodeLine{177 \textcolor{comment}{ * \(\backslash\)code}}
\DoxyCodeLine{178 \textcolor{comment}{ * ./svzerodsolver path/to/config.json path/to/output.csv}}
\DoxyCodeLine{179 \textcolor{comment}{ * \(\backslash\)endcode}}
\DoxyCodeLine{180 \textcolor{comment}{ *}}
\DoxyCodeLine{181 \textcolor{comment}{ * `path/to/config.json` and `path/to/output.csv` should be replaced by the}}
\DoxyCodeLine{182 \textcolor{comment}{ * correct paths to the input and output file, respectively.}}
\DoxyCodeLine{183 \textcolor{comment}{ *}}
\DoxyCodeLine{184 \textcolor{comment}{ * \#\# Simulation parameters}}
\DoxyCodeLine{185 \textcolor{comment}{ *}}
\DoxyCodeLine{186 \textcolor{comment}{ * The svZeroDSolver can be configured with the following options in the}}
\DoxyCodeLine{187 \textcolor{comment}{ * `simulation\_parameters` section of the input file. Parameters without a}}
\DoxyCodeLine{188 \textcolor{comment}{ * default value must be specified.}}
\DoxyCodeLine{189 \textcolor{comment}{ * }}
\DoxyCodeLine{190 \textcolor{comment}{ *}}
\DoxyCodeLine{191 \textcolor{comment}{ * Parameter key                           | Description                               | Default value}}
\DoxyCodeLine{192 \textcolor{comment}{ * -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ | -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ | -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ }}
\DoxyCodeLine{193 \textcolor{comment}{ * number\_of\_cardiac\_cycles                | Number of cardiac cycles to simulate      | -\/}}
\DoxyCodeLine{194 \textcolor{comment}{ * number\_of\_time\_pts\_per\_cardiac\_cycle    | Number of time steps per cardiac cycle    | -\/}}
\DoxyCodeLine{195 \textcolor{comment}{ * absolute\_tolerance                      | Absolute tolerance for time integration   | \(\backslash\)f\$10\string^\{-\/8\}\(\backslash\)f\$}}
\DoxyCodeLine{196 \textcolor{comment}{ * maximum\_nonlinear\_iterations            | Maximum number of nonlinear iterations for time integration | \(\backslash\)f\$30\(\backslash\)f\$}}
\DoxyCodeLine{197 \textcolor{comment}{ * steady\_initial                          | Toggle whether to use the steady solution as the initial condition for the simulation | true}}
\DoxyCodeLine{198 \textcolor{comment}{ * output\_variable\_based                   | Output solution based on variables (i.e. flow+pressure at nodes and internal variables) | false}}
\DoxyCodeLine{199 \textcolor{comment}{ * output\_interval                         | The frequency of writing timesteps to the output (1 means every time step is written to output) | \(\backslash\)f\$1\(\backslash\)f\$}}
\DoxyCodeLine{200 \textcolor{comment}{ * output\_mean\_only                        | Write only the mean values over every timestep to output file | false}}
\DoxyCodeLine{201 \textcolor{comment}{ * output\_derivative                       | Write time derivatives to output file | false}}
\DoxyCodeLine{202 \textcolor{comment}{ * output\_last\_cycle\_only                  | Write only the last cardiac cycle | false}}
\DoxyCodeLine{203 \textcolor{comment}{ * }}
\DoxyCodeLine{204 \textcolor{comment}{ * }}
\DoxyCodeLine{205 \textcolor{comment}{ * \# Developer Guide}}
\DoxyCodeLine{206 \textcolor{comment}{ * }}
\DoxyCodeLine{207 \textcolor{comment}{ * If you are a developer and want to contribute to svZeroDSolver, you can find}}
\DoxyCodeLine{208 \textcolor{comment}{ * more helpful information in our [Developer Guide](docs/cpp/pages/developer\_guide.md).}}
\DoxyCodeLine{209 \textcolor{comment}{ * }}
\DoxyCodeLine{210 \textcolor{comment}{ */}}
\DoxyCodeLine{211 \textcolor{comment}{// clang-\/format on}}
\DoxyCodeLine{212 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{integrator_8hpp}{algebra/integrator.hpp}}"{}}}
\DoxyCodeLine{213 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{state_8hpp}{algebra/state.hpp}}"{}}}
\DoxyCodeLine{214 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{debug_8hpp}{helpers/debug.hpp}}"{}}}
\DoxyCodeLine{215 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{endswith_8hpp}{helpers/endswith.hpp}}"{}}}
\DoxyCodeLine{216 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{configreader_8hpp}{io/configreader.hpp}}"{}}}
\DoxyCodeLine{217 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{csvwriter_8hpp}{io/csvwriter.hpp}}"{}}}
\DoxyCodeLine{218 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{jsonhandler_8hpp}{io/jsonhandler.hpp}}"{}}}
\DoxyCodeLine{219 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{model_8hpp}{model/model.hpp}}"{}}}
\DoxyCodeLine{220 }
\DoxyCodeLine{221 \textcolor{comment}{// Setting scalar type to double}}
\DoxyCodeLine{222 \textcolor{keyword}{typedef} \textcolor{keywordtype}{double} T;}
\DoxyCodeLine{223 \textcolor{comment}{}}
\DoxyCodeLine{224 \textcolor{comment}{/**}}
\DoxyCodeLine{225 \textcolor{comment}{ *}}
\DoxyCodeLine{226 \textcolor{comment}{ * @brief Run svZeroDSolver with configuration}}
\DoxyCodeLine{227 \textcolor{comment}{ *}}
\DoxyCodeLine{228 \textcolor{comment}{ * 1. Read the input file}}
\DoxyCodeLine{229 \textcolor{comment}{ * 2. Create the 0D model}}
\DoxyCodeLine{230 \textcolor{comment}{ * 3. (Optional) Solve for steady initial condition}}
\DoxyCodeLine{231 \textcolor{comment}{ * 4. Run simulation}}
\DoxyCodeLine{232 \textcolor{comment}{ * 5. Write output to file}}
\DoxyCodeLine{233 \textcolor{comment}{ *}}
\DoxyCodeLine{234 \textcolor{comment}{ * @param json\_config Path config or json encoded string with config}}
\DoxyCodeLine{235 \textcolor{comment}{ * @return Result as csv encoded string}}
\DoxyCodeLine{236 \textcolor{comment}{ */}}
\DoxyCodeLine{237 \textcolor{keyword}{const} std::string \mbox{\hyperlink{main_8hpp_aae5545ab6c56b7cc1c5ece3968733415}{run}}(std::string\_view json\_config) \{}
\DoxyCodeLine{238   \textcolor{comment}{// Load model and configuration}}
\DoxyCodeLine{239   DEBUG\_MSG(\textcolor{stringliteral}{"{}Read configuration"{}});}
\DoxyCodeLine{240   \mbox{\hyperlink{class_i_o_1_1_config_reader}{IO::ConfigReader<T>}} reader;}
\DoxyCodeLine{241   \textcolor{keyword}{auto} handler = \mbox{\hyperlink{class_i_o_1_1_json_handler}{IO::JsonHandler}}(json\_config);}
\DoxyCodeLine{242   reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a920b46f9e97b98a6525442e5a8f5cebd}{load}}(handler);}
\DoxyCodeLine{243 }
\DoxyCodeLine{244   \textcolor{comment}{// Setup system}}
\DoxyCodeLine{245   \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state}{ALGEBRA::State<T>}} state = reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_abe9831cb10972b4982a766aac615cb6c}{initial\_state}};}
\DoxyCodeLine{246 }
\DoxyCodeLine{247   \textcolor{comment}{// Create steady initial}}
\DoxyCodeLine{248   \textcolor{keywordflow}{if} (reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a1e593472af26af8f4bf98b158d996434}{sim\_steady\_initial}}) \{}
\DoxyCodeLine{249     DEBUG\_MSG(\textcolor{stringliteral}{"{}Calculate steady initial condition"{}});}
\DoxyCodeLine{250     T time\_step\_size\_steady = reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_aaa79d0afffb88356f8d4ccbb7628309f}{sim\_cardiac\_cycle\_period}} / 10.0;}
\DoxyCodeLine{251     reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_ae442b4d3b3c7891a0584bd6fbf895dce}{model}}-\/>to\_steady();}
\DoxyCodeLine{252     \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator}{ALGEBRA::Integrator<T>}} integrator\_steady(}
\DoxyCodeLine{253         *reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_ae442b4d3b3c7891a0584bd6fbf895dce}{model}}, time\_step\_size\_steady, 0.1, reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a46b1de73e58adb34d4e783e83e1e22e9}{sim\_abs\_tol}},}
\DoxyCodeLine{254         reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a4e0c08c222cc1ede5011c867d22a7f9d}{sim\_nliter}});}
\DoxyCodeLine{255     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 31; i++) \{}
\DoxyCodeLine{256       state = integrator\_steady.\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator_ac64552c2b5d1007b5f0bb37ab4b125b7}{step}}(state, time\_step\_size\_steady * T(i),}
\DoxyCodeLine{257                                      *reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_ae442b4d3b3c7891a0584bd6fbf895dce}{model}});}
\DoxyCodeLine{258     \}}
\DoxyCodeLine{259     reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_ae442b4d3b3c7891a0584bd6fbf895dce}{model}}-\/>to\_unsteady();}
\DoxyCodeLine{260   \}}
\DoxyCodeLine{261 }
\DoxyCodeLine{262   \textcolor{comment}{// Set-\/up integrator}}
\DoxyCodeLine{263   DEBUG\_MSG(\textcolor{stringliteral}{"{}Setup time integration"{}});}
\DoxyCodeLine{264   \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator}{ALGEBRA::Integrator<T>}} integrator(*reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_ae442b4d3b3c7891a0584bd6fbf895dce}{model}}, reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a8ad19204e82a0f29790452485f36a2ba}{sim\_time\_step\_size}},}
\DoxyCodeLine{265                                     0.1, reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a46b1de73e58adb34d4e783e83e1e22e9}{sim\_abs\_tol}}, reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a4e0c08c222cc1ede5011c867d22a7f9d}{sim\_nliter}});}
\DoxyCodeLine{266 }
\DoxyCodeLine{267   \textcolor{comment}{// Initialize loop}}
\DoxyCodeLine{268   std::vector<ALGEBRA::State<T>> states;}
\DoxyCodeLine{269   std::vector<T> times;}
\DoxyCodeLine{270   \textcolor{keywordflow}{if} (reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_ad872723e0b5862abc77290a2152556f0}{output\_last\_cycle\_only}}) \{}
\DoxyCodeLine{271     \textcolor{keywordtype}{int} num\_states = reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_af4bde4c7696a7af78e607707e111f5b9}{sim\_pts\_per\_cycle}} / reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_adf7c3390971a4ce76c8d4d7a6bd24cc1}{output\_interval}} + 1;}
\DoxyCodeLine{272     states.reserve(num\_states);}
\DoxyCodeLine{273     times.reserve(num\_states);}
\DoxyCodeLine{274   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{275     \textcolor{keywordtype}{int} num\_states = reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a77fc4400616332eef67acb58ad071208}{sim\_num\_time\_steps}} / reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_adf7c3390971a4ce76c8d4d7a6bd24cc1}{output\_interval}} + 1;}
\DoxyCodeLine{276     states.reserve(num\_states);}
\DoxyCodeLine{277     times.reserve(num\_states);}
\DoxyCodeLine{278   \}}
\DoxyCodeLine{279   T time = 0.0;}
\DoxyCodeLine{280 }
\DoxyCodeLine{281   \textcolor{comment}{// Run integrator}}
\DoxyCodeLine{282   DEBUG\_MSG(\textcolor{stringliteral}{"{}Run time integration"{}});}
\DoxyCodeLine{283   \textcolor{keywordtype}{int} interval\_counter = 0;}
\DoxyCodeLine{284   \textcolor{keywordtype}{int} start\_last\_cycle = reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a77fc4400616332eef67acb58ad071208}{sim\_num\_time\_steps}} -\/ reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_af4bde4c7696a7af78e607707e111f5b9}{sim\_pts\_per\_cycle}};}
\DoxyCodeLine{285   \textcolor{keywordflow}{if} ((reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_ad872723e0b5862abc77290a2152556f0}{output\_last\_cycle\_only}} == \textcolor{keyword}{false}) || (0 >= start\_last\_cycle)) \{}
\DoxyCodeLine{286     times.push\_back(time);}
\DoxyCodeLine{287     states.push\_back(std::move(state));}
\DoxyCodeLine{288   \}}
\DoxyCodeLine{289   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i < reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a77fc4400616332eef67acb58ad071208}{sim\_num\_time\_steps}}; i++) \{}
\DoxyCodeLine{290     \textcolor{comment}{// DEBUG\_MSG("{}Integration time: "{}<< time << std::endl);}}
\DoxyCodeLine{291     state = integrator.\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator_ac64552c2b5d1007b5f0bb37ab4b125b7}{step}}(state, time, *reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_ae442b4d3b3c7891a0584bd6fbf895dce}{model}});}
\DoxyCodeLine{292     interval\_counter += 1;}
\DoxyCodeLine{293     time = reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a8ad19204e82a0f29790452485f36a2ba}{sim\_time\_step\_size}} * T(i);}
\DoxyCodeLine{294     \textcolor{keywordflow}{if} ((interval\_counter == reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_adf7c3390971a4ce76c8d4d7a6bd24cc1}{output\_interval}}) ||}
\DoxyCodeLine{295         (reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_ad872723e0b5862abc77290a2152556f0}{output\_last\_cycle\_only}} \&\& (i == start\_last\_cycle))) \{}
\DoxyCodeLine{296       \textcolor{keywordflow}{if} ((reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_ad872723e0b5862abc77290a2152556f0}{output\_last\_cycle\_only}} == \textcolor{keyword}{false}) || (i >= start\_last\_cycle)) \{}
\DoxyCodeLine{297         times.push\_back(time);}
\DoxyCodeLine{298         states.push\_back(std::move(state));}
\DoxyCodeLine{299       \}}
\DoxyCodeLine{300       interval\_counter = 0;}
\DoxyCodeLine{301     \}}
\DoxyCodeLine{302   \}}
\DoxyCodeLine{303 }
\DoxyCodeLine{304   \textcolor{comment}{// Make times start from 0}}
\DoxyCodeLine{305   \textcolor{keywordflow}{if} (reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_ad872723e0b5862abc77290a2152556f0}{output\_last\_cycle\_only}}) \{}
\DoxyCodeLine{306     T start\_time = times[0];}
\DoxyCodeLine{307     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& time : times) \{}
\DoxyCodeLine{308       time -\/= start\_time;}
\DoxyCodeLine{309     \}}
\DoxyCodeLine{310   \}}
\DoxyCodeLine{311 }
\DoxyCodeLine{312   \textcolor{comment}{// Write csv output string}}
\DoxyCodeLine{313   DEBUG\_MSG(\textcolor{stringliteral}{"{}Write output"{}});}
\DoxyCodeLine{314   std::string output;}
\DoxyCodeLine{315   \textcolor{keywordflow}{if} (reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_acfee0686c847138a19ad12ad71d57750}{output\_variable\_based}}) \{}
\DoxyCodeLine{316     output = IO::to\_variable\_csv<T>(times, states, *reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_ae442b4d3b3c7891a0584bd6fbf895dce}{model}},}
\DoxyCodeLine{317                                     reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a4b5b5b7b81108221d204840937dbad35}{output\_mean\_only}},}
\DoxyCodeLine{318                                     reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a77d8dac5655f87b49476fd4f40029bb6}{output\_derivative}});}
\DoxyCodeLine{319   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{320     output =}
\DoxyCodeLine{321         IO::to\_vessel\_csv<T>(times, states, *reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_ae442b4d3b3c7891a0584bd6fbf895dce}{model}},}
\DoxyCodeLine{322                              reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a4b5b5b7b81108221d204840937dbad35}{output\_mean\_only}}, reader.\mbox{\hyperlink{class_i_o_1_1_config_reader_a77d8dac5655f87b49476fd4f40029bb6}{output\_derivative}});}
\DoxyCodeLine{323   \}}
\DoxyCodeLine{324   DEBUG\_MSG(\textcolor{stringliteral}{"{}Finished"{}});}
\DoxyCodeLine{325   \textcolor{keywordflow}{return} output;}
\DoxyCodeLine{326 \}}

\end{DoxyCode}

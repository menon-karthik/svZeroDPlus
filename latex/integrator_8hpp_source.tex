\hypertarget{integrator_8hpp_source}{}\doxysection{integrator.\+hpp}
\label{integrator_8hpp_source}\index{algebra/integrator.hpp@{algebra/integrator.hpp}}
\mbox{\hyperlink{integrator_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// Copyright (c) Stanford University, The Regents of the University of}}
\DoxyCodeLine{2 \textcolor{comment}{//               California, and others.}}
\DoxyCodeLine{3 \textcolor{comment}{//}}
\DoxyCodeLine{4 \textcolor{comment}{// All Rights Reserved.}}
\DoxyCodeLine{5 \textcolor{comment}{//}}
\DoxyCodeLine{6 \textcolor{comment}{// See Copyright-\/SimVascular.txt for additional details.}}
\DoxyCodeLine{7 \textcolor{comment}{//}}
\DoxyCodeLine{8 \textcolor{comment}{// Permission is hereby granted, free of charge, to any person obtaining}}
\DoxyCodeLine{9 \textcolor{comment}{// a copy of this software and associated documentation files (the}}
\DoxyCodeLine{10 \textcolor{comment}{// "{}Software"{}), to deal in the Software without restriction, including}}
\DoxyCodeLine{11 \textcolor{comment}{// without limitation the rights to use, copy, modify, merge, publish,}}
\DoxyCodeLine{12 \textcolor{comment}{// distribute, sublicense, and/or sell copies of the Software, and to}}
\DoxyCodeLine{13 \textcolor{comment}{// permit persons to whom the Software is furnished to do so, subject}}
\DoxyCodeLine{14 \textcolor{comment}{// to the following conditions:}}
\DoxyCodeLine{15 \textcolor{comment}{//}}
\DoxyCodeLine{16 \textcolor{comment}{// The above copyright notice and this permission notice shall be included}}
\DoxyCodeLine{17 \textcolor{comment}{// in all copies or substantial portions of the Software.}}
\DoxyCodeLine{18 \textcolor{comment}{//}}
\DoxyCodeLine{19 \textcolor{comment}{// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "{}AS}}
\DoxyCodeLine{20 \textcolor{comment}{// IS"{} AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED}}
\DoxyCodeLine{21 \textcolor{comment}{// TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A}}
\DoxyCodeLine{22 \textcolor{comment}{// PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER}}
\DoxyCodeLine{23 \textcolor{comment}{// OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,}}
\DoxyCodeLine{24 \textcolor{comment}{// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,}}
\DoxyCodeLine{25 \textcolor{comment}{// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR}}
\DoxyCodeLine{26 \textcolor{comment}{// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF}}
\DoxyCodeLine{27 \textcolor{comment}{// LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING}}
\DoxyCodeLine{28 \textcolor{comment}{// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS}}
\DoxyCodeLine{29 \textcolor{comment}{// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.}\textcolor{comment}{}}
\DoxyCodeLine{30 \textcolor{comment}{/**}}
\DoxyCodeLine{31 \textcolor{comment}{ * @file integrator.hpp}}
\DoxyCodeLine{32 \textcolor{comment}{ * @brief ALGEBRA::Integrator source file}}
\DoxyCodeLine{33 \textcolor{comment}{ */}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\#ifndef SVZERODSOLVER\_ALGEBRA\_INTEGRATOR\_HPP\_}}
\DoxyCodeLine{35 \textcolor{preprocessor}{\#define SVZERODSOLVER\_ALGEBRA\_INTEGRATOR\_HPP\_}}
\DoxyCodeLine{36 }
\DoxyCodeLine{37 \textcolor{preprocessor}{\#include <Eigen/Dense>}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \textcolor{preprocessor}{\#include "{}../helpers/debug.hpp"{}}}
\DoxyCodeLine{40 \textcolor{preprocessor}{\#include "{}../model/model.hpp"{}}}
\DoxyCodeLine{41 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{state_8hpp}{state.hpp}}"{}}}
\DoxyCodeLine{42 }
\DoxyCodeLine{43 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespace_a_l_g_e_b_r_a}{ALGEBRA}} \{}
\DoxyCodeLine{44 \textcolor{comment}{}}
\DoxyCodeLine{45 \textcolor{comment}{/**}}
\DoxyCodeLine{46 \textcolor{comment}{ * @brief Generalized-\/alpha integrator}}
\DoxyCodeLine{47 \textcolor{comment}{ *}}
\DoxyCodeLine{48 \textcolor{comment}{ * This class handles the time integration scheme for solving 0D blood}}
\DoxyCodeLine{49 \textcolor{comment}{ * flow system.}}
\DoxyCodeLine{50 \textcolor{comment}{ *}}
\DoxyCodeLine{51 \textcolor{comment}{ * Flow rate, pressure, and other hemodynamic quantities in 0D models of}}
\DoxyCodeLine{52 \textcolor{comment}{ * vascular anatomies are governed by a system of nonlinear}}
\DoxyCodeLine{53 \textcolor{comment}{ * differential-\/algebraic equations (DAEs):}}
\DoxyCodeLine{54 \textcolor{comment}{ *}}
\DoxyCodeLine{55 \textcolor{comment}{ * \(\backslash\)f[}}
\DoxyCodeLine{56 \textcolor{comment}{ * \(\backslash\)mathbf\{E\}(\(\backslash\)mathbf\{y\}, t) \(\backslash\)cdot \(\backslash\)dot\{\(\backslash\)mathbf\{y\}\}+\(\backslash\)mathbf\{F\}(\(\backslash\)mathbf\{y\}, t)}}
\DoxyCodeLine{57 \textcolor{comment}{ * \(\backslash\)cdot \(\backslash\)mathbf\{y\}+\(\backslash\)mathbf\{c\}(\(\backslash\)mathbf\{y\}, t)=\(\backslash\)mathbf\{0\} \(\backslash\)f]}}
\DoxyCodeLine{58 \textcolor{comment}{ *}}
\DoxyCodeLine{59 \textcolor{comment}{ * Here, \(\backslash\)f\$y\(\backslash\)f\$ is the vector of solution quantities and \(\backslash\)f\$\(\backslash\)dot\{y\}\(\backslash\)f\$ is the}}
\DoxyCodeLine{60 \textcolor{comment}{ * time derivative of \(\backslash\)f\$y\(\backslash\)f\$. \(\backslash\)f\$N\(\backslash\)f\$ is the total number of equations and the}}
\DoxyCodeLine{61 \textcolor{comment}{ * total number of global unknowns. The DAE system is solved implicitly using}}
\DoxyCodeLine{62 \textcolor{comment}{ * the generalized-\/\(\backslash\)f\$\(\backslash\)alpha\(\backslash\)f\$ method \(\backslash\)cite JANSEN2000305.}}
\DoxyCodeLine{63 \textcolor{comment}{ *}}
\DoxyCodeLine{64 \textcolor{comment}{ * @tparam T Scalar type (e.g. `float`, `double`)}}
\DoxyCodeLine{65 \textcolor{comment}{ * `ALGEBRA::SparseSystem`)}}
\DoxyCodeLine{66 \textcolor{comment}{ */}}
\DoxyCodeLine{67 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{68 \textcolor{keyword}{class }\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator}{Integrator}} \{}
\DoxyCodeLine{69  \textcolor{keyword}{private}:}
\DoxyCodeLine{70   T alpha\_m;}
\DoxyCodeLine{71   T alpha\_f;}
\DoxyCodeLine{72   T alpha\_m\_inv;}
\DoxyCodeLine{73   T alpha\_f\_inv;}
\DoxyCodeLine{74   T gamma;}
\DoxyCodeLine{75   T gamma\_inv;}
\DoxyCodeLine{76   T time\_step\_size;}
\DoxyCodeLine{77   T time\_step\_size\_inv;}
\DoxyCodeLine{78   T y\_dot\_coeff;}
\DoxyCodeLine{79   T atol;}
\DoxyCodeLine{80   T y\_init\_coeff;}
\DoxyCodeLine{81   T ydot\_init\_coeff;}
\DoxyCodeLine{82   \textcolor{keywordtype}{int} max\_iter;}
\DoxyCodeLine{83   \textcolor{keywordtype}{int} size;}
\DoxyCodeLine{84   Eigen::Matrix<T, Eigen::Dynamic, 1> y\_af;}
\DoxyCodeLine{85   Eigen::Matrix<T, Eigen::Dynamic, 1> ydot\_am;}
\DoxyCodeLine{86   \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_sparse_system}{SparseSystem<T>}} system;}
\DoxyCodeLine{87 }
\DoxyCodeLine{88  \textcolor{keyword}{public}:\textcolor{comment}{}}
\DoxyCodeLine{89 \textcolor{comment}{  /**}}
\DoxyCodeLine{90 \textcolor{comment}{   * @brief Construct a new Integrator object}}
\DoxyCodeLine{91 \textcolor{comment}{   *}}
\DoxyCodeLine{92 \textcolor{comment}{   * @param system System of equations to integrate}}
\DoxyCodeLine{93 \textcolor{comment}{   * @param time\_step\_size Time step size for generalized-\/alpha step}}
\DoxyCodeLine{94 \textcolor{comment}{   * @param rho Spectral radius for generalized-\/alpha step}}
\DoxyCodeLine{95 \textcolor{comment}{   * @param atol Absolut tolerance for non-\/linear iteration termination}}
\DoxyCodeLine{96 \textcolor{comment}{   * @param max\_iter Maximum number of non-\/linear iterations}}
\DoxyCodeLine{97 \textcolor{comment}{   */}}
\DoxyCodeLine{98   \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator_af4f52400a2ba9332c32e2f3cb44de126}{Integrator}}(\mbox{\hyperlink{class_m_o_d_e_l_1_1_model}{MODEL::Model<T>}} \&model, T time\_step\_size, T rho, T atol,}
\DoxyCodeLine{99              \textcolor{keywordtype}{int} max\_iter);}
\DoxyCodeLine{100 \textcolor{comment}{}}
\DoxyCodeLine{101 \textcolor{comment}{  /**}}
\DoxyCodeLine{102 \textcolor{comment}{   * @brief Construct a new Integrator object}}
\DoxyCodeLine{103 \textcolor{comment}{   *}}
\DoxyCodeLine{104 \textcolor{comment}{   */}}
\DoxyCodeLine{105   \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator_af4f52400a2ba9332c32e2f3cb44de126}{Integrator}}();}
\DoxyCodeLine{106 \textcolor{comment}{}}
\DoxyCodeLine{107 \textcolor{comment}{  /**}}
\DoxyCodeLine{108 \textcolor{comment}{   * @brief Destroy the Integrator object}}
\DoxyCodeLine{109 \textcolor{comment}{   *}}
\DoxyCodeLine{110 \textcolor{comment}{   */}}
\DoxyCodeLine{111   \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator_a5d4708faf6c9443ad8a59329fc3c1812}{\string~Integrator}}();}
\DoxyCodeLine{112 \textcolor{comment}{}}
\DoxyCodeLine{113 \textcolor{comment}{  /**}}
\DoxyCodeLine{114 \textcolor{comment}{   * @brief Delete dynamically allocated memory (in class member SparseSystem<T>}}
\DoxyCodeLine{115 \textcolor{comment}{   * system).}}
\DoxyCodeLine{116 \textcolor{comment}{   */}}
\DoxyCodeLine{117   \textcolor{keywordtype}{void} \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator_a0e27a441720f787e90ff7f220cc796d9}{clean}}();}
\DoxyCodeLine{118 \textcolor{comment}{}}
\DoxyCodeLine{119 \textcolor{comment}{  /**}}
\DoxyCodeLine{120 \textcolor{comment}{   * @brief Update integrator parameter and system matrices with model parameter}}
\DoxyCodeLine{121 \textcolor{comment}{   * updates.}}
\DoxyCodeLine{122 \textcolor{comment}{   *}}
\DoxyCodeLine{123 \textcolor{comment}{   * @param model ZeroD model being solved}}
\DoxyCodeLine{124 \textcolor{comment}{   * @param time\_step\_size Time step size for 0D model}}
\DoxyCodeLine{125 \textcolor{comment}{   */}}
\DoxyCodeLine{126   \textcolor{keywordtype}{void} \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator_a7a68e2d7aa7056308b280393e3e6dcc9}{update\_params}}(\mbox{\hyperlink{class_m_o_d_e_l_1_1_model}{MODEL::Model<T>}} \&model, T time\_step\_size);}
\DoxyCodeLine{127 \textcolor{comment}{}}
\DoxyCodeLine{128 \textcolor{comment}{  /**}}
\DoxyCodeLine{129 \textcolor{comment}{   * @brief Perform a time step}}
\DoxyCodeLine{130 \textcolor{comment}{   *}}
\DoxyCodeLine{131 \textcolor{comment}{   * @param state Current state}}
\DoxyCodeLine{132 \textcolor{comment}{   * @param time Current time}}
\DoxyCodeLine{133 \textcolor{comment}{   * @param model The model}}
\DoxyCodeLine{134 \textcolor{comment}{   * @return New state}}
\DoxyCodeLine{135 \textcolor{comment}{   */}}
\DoxyCodeLine{136   \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state}{State<T>}} \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator_ac64552c2b5d1007b5f0bb37ab4b125b7}{step}}(\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state}{State<T>}} \&state, T time, \mbox{\hyperlink{class_m_o_d_e_l_1_1_model}{MODEL::Model<T>}} \&model);}
\DoxyCodeLine{137 \};}
\DoxyCodeLine{138 }
\DoxyCodeLine{139 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{140 \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator_af4f52400a2ba9332c32e2f3cb44de126}{Integrator<T>::Integrator}}(\mbox{\hyperlink{class_m_o_d_e_l_1_1_model}{MODEL::Model<T>}} \&model, T time\_step\_size, T rho,}
\DoxyCodeLine{141                           T atol, \textcolor{keywordtype}{int} max\_iter) \{}
\DoxyCodeLine{142   alpha\_m = 0.5 * (3.0 -\/ rho) / (1.0 + rho);}
\DoxyCodeLine{143   alpha\_f = 1.0 / (1.0 + rho);}
\DoxyCodeLine{144   alpha\_m\_inv = 1.0 / alpha\_m;}
\DoxyCodeLine{145   alpha\_f\_inv = 1.0 / alpha\_f;}
\DoxyCodeLine{146   gamma = 0.5 + alpha\_m -\/ alpha\_f;}
\DoxyCodeLine{147   gamma\_inv = 1.0 / gamma;}
\DoxyCodeLine{148 }
\DoxyCodeLine{149   y\_init\_coeff = alpha\_f * 0.5 * time\_step\_size;}
\DoxyCodeLine{150   ydot\_init\_coeff = (1.0 + alpha\_m * ((gamma -\/ 0.5) * gamma\_inv -\/ 1.0));}
\DoxyCodeLine{151 }
\DoxyCodeLine{152   size = model.\mbox{\hyperlink{class_m_o_d_e_l_1_1_model_a43b9cc3c9874be9c2baeae576271fbad}{dofhandler}}.\mbox{\hyperlink{class_m_o_d_e_l_1_1_d_o_f_handler_acff2844be5b12678f603ca677a2c17f3}{size}}();}
\DoxyCodeLine{153   system = \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_sparse_system}{SparseSystem<T>}}(size);}
\DoxyCodeLine{154   this-\/>time\_step\_size = time\_step\_size;}
\DoxyCodeLine{155   this-\/>atol = atol;}
\DoxyCodeLine{156   this-\/>max\_iter = max\_iter;}
\DoxyCodeLine{157   time\_step\_size\_inv = 1.0 / time\_step\_size;}
\DoxyCodeLine{158 }
\DoxyCodeLine{159   y\_af = Eigen::Matrix<T, Eigen::Dynamic, 1>(size);}
\DoxyCodeLine{160   ydot\_am = Eigen::Matrix<T, Eigen::Dynamic, 1>(size);}
\DoxyCodeLine{161 }
\DoxyCodeLine{162   y\_dot\_coeff = alpha\_m * alpha\_f\_inv * gamma\_inv * time\_step\_size\_inv;}
\DoxyCodeLine{163 }
\DoxyCodeLine{164   \textcolor{comment}{// Make some memory reservations}}
\DoxyCodeLine{165   system.reserve(model);}
\DoxyCodeLine{166 \}}
\DoxyCodeLine{167 }
\DoxyCodeLine{168 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{169 \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator_af4f52400a2ba9332c32e2f3cb44de126}{Integrator<T>::Integrator}}() \{\}}
\DoxyCodeLine{170 }
\DoxyCodeLine{171 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{172 \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator_a5d4708faf6c9443ad8a59329fc3c1812}{Integrator<T>::\string~Integrator}}() \{\}}
\DoxyCodeLine{173 }
\DoxyCodeLine{174 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{175 \textcolor{keywordtype}{void} \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator_a0e27a441720f787e90ff7f220cc796d9}{Integrator<T>::clean}}() \{}
\DoxyCodeLine{176   \textcolor{comment}{// Cannot be in destructor because dynamically allocated pointers will be lost}}
\DoxyCodeLine{177   \textcolor{comment}{// when objects are assigned from temporary objects.}}
\DoxyCodeLine{178   system.clean();}
\DoxyCodeLine{179 \}}
\DoxyCodeLine{180 }
\DoxyCodeLine{181 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{182 \textcolor{keywordtype}{void} \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator_a7a68e2d7aa7056308b280393e3e6dcc9}{Integrator<T>::update\_params}}(\mbox{\hyperlink{class_m_o_d_e_l_1_1_model}{MODEL::Model<T>}} \&model, T time\_step\_size) \{}
\DoxyCodeLine{183   y\_init\_coeff = alpha\_f * 0.5 * time\_step\_size;}
\DoxyCodeLine{184   this-\/>time\_step\_size = time\_step\_size;}
\DoxyCodeLine{185   time\_step\_size\_inv = 1.0 / time\_step\_size;}
\DoxyCodeLine{186   y\_dot\_coeff = alpha\_m * alpha\_f\_inv * gamma\_inv * time\_step\_size\_inv;}
\DoxyCodeLine{187   model.\mbox{\hyperlink{class_m_o_d_e_l_1_1_model_ab251541e14d080d82639950015579413}{update\_constant}}(system);}
\DoxyCodeLine{188   model.\mbox{\hyperlink{class_m_o_d_e_l_1_1_model_a7cb64c8d49c6dc41d2c00df1cc24132d}{update\_time}}(system, 0.0);}
\DoxyCodeLine{189 \}}
\DoxyCodeLine{190 }
\DoxyCodeLine{191 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{192 \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state}{State<T>}} \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_integrator_ac64552c2b5d1007b5f0bb37ab4b125b7}{Integrator<T>::step}}(\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state}{State<T>}} \&old\_state, T time,}
\DoxyCodeLine{193                              \mbox{\hyperlink{class_m_o_d_e_l_1_1_model}{MODEL::Model<T>}} \&model) \{}
\DoxyCodeLine{194   \textcolor{comment}{// Predictor + initiator step}}
\DoxyCodeLine{195   y\_af.setZero();}
\DoxyCodeLine{196   ydot\_am.setZero();}
\DoxyCodeLine{197   y\_af += old\_state.\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state_a5e310eddee49852d84d0749cbf104e57}{y}} + old\_state.\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state_aa1042453417a1af57edc93e3192270a9}{ydot}} * y\_init\_coeff;}
\DoxyCodeLine{198   ydot\_am += old\_state.\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state_aa1042453417a1af57edc93e3192270a9}{ydot}} * ydot\_init\_coeff;}
\DoxyCodeLine{199 }
\DoxyCodeLine{200   \textcolor{comment}{// Determine new time}}
\DoxyCodeLine{201   T new\_time = time + alpha\_f * time\_step\_size;}
\DoxyCodeLine{202 }
\DoxyCodeLine{203   \textcolor{comment}{// Update time-\/dependent element contributions in system}}
\DoxyCodeLine{204   model.\mbox{\hyperlink{class_m_o_d_e_l_1_1_model_a7cb64c8d49c6dc41d2c00df1cc24132d}{update\_time}}(system, new\_time);}
\DoxyCodeLine{205 }
\DoxyCodeLine{206   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < max\_iter; i++) \{}
\DoxyCodeLine{207     \textcolor{comment}{// Update solution-\/dependent element contribitions}}
\DoxyCodeLine{208     model.\mbox{\hyperlink{class_m_o_d_e_l_1_1_model_a2e33d813e05f809fad8541a12189648a}{update\_solution}}(system, y\_af);}
\DoxyCodeLine{209 }
\DoxyCodeLine{210     \textcolor{comment}{// Update residuum and check termination criteria}}
\DoxyCodeLine{211     system.update\_residual(y\_af, ydot\_am);}
\DoxyCodeLine{212     \textcolor{keywordflow}{if} (system.residual.cwiseAbs().maxCoeff() < atol) \{}
\DoxyCodeLine{213       \textcolor{keywordflow}{break};}
\DoxyCodeLine{214     \}}
\DoxyCodeLine{215 }
\DoxyCodeLine{216     \textcolor{comment}{// Abort if maximum number of non-\/linear iterations is reached}}
\DoxyCodeLine{217     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (i == max\_iter -\/ 1) \{}
\DoxyCodeLine{218       \textcolor{keywordflow}{throw} std::runtime\_error(}
\DoxyCodeLine{219           \textcolor{stringliteral}{"{}Maxium number of non-\/linear iterations reached."{}});}
\DoxyCodeLine{220     \}}
\DoxyCodeLine{221 }
\DoxyCodeLine{222     \textcolor{comment}{// Determine jacobian}}
\DoxyCodeLine{223     system.update\_jacobian(y\_dot\_coeff);}
\DoxyCodeLine{224 }
\DoxyCodeLine{225     \textcolor{comment}{// Solve system}}
\DoxyCodeLine{226     system.solve();}
\DoxyCodeLine{227 }
\DoxyCodeLine{228     \textcolor{comment}{// Add increment to solution}}
\DoxyCodeLine{229     y\_af += system.dy;}
\DoxyCodeLine{230     ydot\_am += system.dy * y\_dot\_coeff;}
\DoxyCodeLine{231   \}}
\DoxyCodeLine{232 }
\DoxyCodeLine{233   \textcolor{comment}{// Set new state}}
\DoxyCodeLine{234   \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state}{State<T>}} new\_state = \mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state_a8b9bcbe746b0d2b87f7c0381ddf471a3}{State<T>::Zero}}(size);}
\DoxyCodeLine{235   new\_state.\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state_a5e310eddee49852d84d0749cbf104e57}{y}} += old\_state.\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state_a5e310eddee49852d84d0749cbf104e57}{y}} + (y\_af -\/ old\_state.\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state_a5e310eddee49852d84d0749cbf104e57}{y}}) * alpha\_f\_inv;}
\DoxyCodeLine{236   new\_state.\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state_aa1042453417a1af57edc93e3192270a9}{ydot}} += old\_state.\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state_aa1042453417a1af57edc93e3192270a9}{ydot}} + (ydot\_am -\/ old\_state.\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state_aa1042453417a1af57edc93e3192270a9}{ydot}}) * alpha\_m\_inv;}
\DoxyCodeLine{237 }
\DoxyCodeLine{238   \textcolor{keywordflow}{return} new\_state;}
\DoxyCodeLine{239 \}}
\DoxyCodeLine{240 \}  \textcolor{comment}{// namespace ALGEBRA}}
\DoxyCodeLine{241 }
\DoxyCodeLine{242 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// SVZERODSOLVER\_ALGEBRA\_INTEGRATOR\_HPP\_}}

\end{DoxyCode}
